---
import Layout from '../layouts/Layout.astro';
import { sanityClient } from '../lib/sanity';

type Article = {
	_id: string;
	title: string;
	slug?: { current: string };
};

let sanityArticles: Article[] = [];

try {
	sanityArticles = await sanityClient.fetch(
		`*[_type == "post"] | order(_createdAt desc)[0...3]{ _id, title, slug }`,
	);
} catch (error) {
	console.error('Sanity fetch failed', error);
}
---

<Layout title="Astro + Sanity starter">
	<section class="space-y-6 rounded-2xl border border-slate-800/60 bg-slate-900/40 p-6 shadow-xl shadow-indigo-900/30 backdrop-blur">
		<p class="text-sm uppercase tracking-[0.2em] text-indigo-400">
			Headless Web
		</p>
		<h2 class="text-3xl font-semibold text-white">
			Sanity içeriklerinden statik sayfa
		</h2>
		<p class="max-w-3xl text-slate-300">
			Astro, Tailwind ve Sanity entegrasyonu ile Netlify'ya hazır bir web katmanı. CMS
			içeriği build-time'da çekilir, API tarafı down olsa bile sayfalar çalışır.
		</p>
		<div class="grid gap-4 rounded-xl border border-slate-800/60 bg-slate-900/60 p-4">
			<div class="flex items-center justify-between">
				<div>
					<p class="text-sm text-slate-300">Sanity'den son içerikler</p>
					<p class="text-xs text-slate-500">
						Çevre değişkeni yoksa demo dataset'i kullanılır.
					</p>
				</div>
				<a
					class="rounded-md border border-indigo-400/40 px-3 py-2 text-xs font-semibold text-indigo-200 transition hover:border-indigo-300/80 hover:text-white"
					href="https://www.sanity.io/"
					target="_blank"
					rel="noreferrer"
				>
					Open Sanity
				</a>
			</div>
			<ul class="grid gap-3 md:grid-cols-3">
				{sanityArticles.length === 0 && (
					<li class="rounded-lg border border-slate-800/50 bg-slate-900/80 p-4 text-sm text-slate-300">
						Demo içerik bulunamadı. <span class="text-indigo-300">SANITY_PROJECT_ID</span> ve
						<span class="text-indigo-300"> SANITY_DATASET</span> env değişkenlerini ayarlayın.
					</li>
				)}
				{sanityArticles.map((article) => (
					<li class="flex flex-col gap-2 rounded-lg border border-slate-800/70 bg-slate-900/80 p-4 shadow-sm shadow-slate-950/50">
						<p class="text-xs uppercase tracking-wide text-indigo-300">Article</p>
						<p class="text-base font-semibold text-white">{article.title}</p>
						<p class="text-xs text-slate-400">
							Slug: {article?.slug?.current ?? '—'}
						</p>
					</li>
				))}
			</ul>
		</div>
	</section>
</Layout>
